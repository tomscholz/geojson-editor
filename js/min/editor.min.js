function init(){map=new google.maps.Map(document.getElementById("map-holder"),{center:{lat:53.5547142,lng:9.9689018},zoom:16}),map.data.setControls(["Point","LineString","Polygon"]),map.data.setStyle({editable:!0,draggable:!0}),bindDataLayerListeners(map.data),dropContainer=document.getElementById("drop-container"),panel=document.getElementById("panel");var e=document.getElementById("map-holder");geoJsonInput=document.getElementById("geojson-input"),downloadLink=document.getElementById("download-link"),resizeGeoJsonInput(),[e,dropContainer].forEach(function(e){google.maps.event.addDomListener(e,"drop",handleDrop),google.maps.event.addDomListener(e,"dragover",showPanel)}),google.maps.event.addDomListener(e,"dragstart",showPanel),google.maps.event.addDomListener(e,"dragenter",showPanel),google.maps.event.addDomListener(dropContainer,"dragend",hidePanel),google.maps.event.addDomListener(dropContainer,"dragleave",hidePanel),google.maps.event.addDomListener(geoJsonInput,"input",refreshDataFromGeoJson),google.maps.event.addDomListener(geoJsonInput,"input",refreshDownloadLinkFromGeoJson),google.maps.event.addDomListener(window,"resize",resizeGeoJsonInput)}function refreshGeoJsonFromData(){map.data.toGeoJson(function(e){geoJsonInput.value=JSON.stringify(e,null,2),refreshDownloadLinkFromGeoJson()})}function refreshDataFromGeoJson(){var e=new google.maps.Data({map:map,style:map.data.getStyle(),controls:["Point","LineString","Polygon"]});try{var n=JSON.parse(geoJsonInput.value);e.addGeoJson(n)}catch(o){return e.setMap(null),void setGeoJsonValidity(""!==geoJsonInput.value?!1:!0)}map.data.setMap(null),map.data=e,bindDataLayerListeners(e),setGeoJsonValidity(!0)}function refreshDownloadLinkFromGeoJson(){downloadLink.href="data:;base64,"+btoa(geoJsonInput.value)}function bindDataLayerListeners(e){e.addListener("addfeature",refreshGeoJsonFromData),e.addListener("removefeature",refreshGeoJsonFromData),e.addListener("setgeometry",refreshGeoJsonFromData)}function setGeoJsonValidity(e){e?geoJsonInput.className="":geoJsonInput.className="invalid"}function showPanel(e){return e.stopPropagation(),e.preventDefault(),dropContainer.className="visible",!1}function hidePanel(){dropContainer.className=""}function handleDrop(e){e.preventDefault(),e.stopPropagation(),hidePanel();var n=e.dataTransfer.files;if(n.length)for(var o,t=0;o=n[t];t++){var a=new FileReader;a.onload=function(e){map.data.addGeoJson(JSON.parse(e.target.result))},a.onerror=function(){console.error("reading failed")},a.readAsText(o)}else{var r=e.dataTransfer.getData("text/plain");r&&map.data.addGeoJson(JSON.parse(r))}return!1}function resizeGeoJsonInput(){var e=geoJsonInput.getBoundingClientRect(),n=panel.getBoundingClientRect();geoJsonInput.style.height=n.bottom-e.top-8+"px"}function toggle_visibility(e){var n=document.getElementById(e);"block"==n.style.display?n.style.display="none":n.style.display="block"}function changeWidth(e){var n=document.getElementById(e);"64.9%"==n.style.width?n.style.width="100%":n.style.width="64.9%"}function resizeMap(e){google.maps.event.trigger(e,"resize"),mapResized=!0}function panelToggle(){toggle_visibility("panel"),changeWidth("map-container"),resizeMap(map)}var map,dropContainer,panel,geoJsonInput,downloadLink;google.maps.event.addDomListener(window,"load",init);var mapResized=!1;window.onbeforeunload=function(){return"Are you sure you want to leave?"};
